<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='本文使用环境： java sdk 1.8 + visual studio 2017 java生成头文件 需声明待调用的dll中的方法为native方法 1 2 3 4 5 6 7 8 // testDll.java public class testDll { static { System.loadLibrary(&amp;#34;testDll&amp;#34;); // dll名不需'><title>JNI 调用 DLL</title>
<link rel=canonical href=/hiwikhome/jni/><link rel=stylesheet href=/scss/style.min.77cb21ae5a34f69a930740b845162008dae4d682e212d21cb2ba9cb0e199ca7b.css><meta property='og:title' content='JNI 调用 DLL'><meta property='og:description' content='本文使用环境： java sdk 1.8 + visual studio 2017 java生成头文件 需声明待调用的dll中的方法为native方法 1 2 3 4 5 6 7 8 // testDll.java public class testDll { static { System.loadLibrary(&amp;#34;testDll&amp;#34;); // dll名不需'><meta property='og:url' content='/hiwikhome/jni/'><meta property='og:site_name' content='HiwiK'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='JNI'><meta property='article:published_time' content='2024-12-24T12:44:03+08:00'><meta property='article:modified_time' content='2024-12-24T12:44:03+08:00'><meta property='og:image' content='/hiwikhome/jni/post.png'><meta name=twitter:title content="JNI 调用 DLL"><meta name=twitter:description content="本文使用环境： java sdk 1.8 + visual studio 2017 java生成头文件 需声明待调用的dll中的方法为native方法 1 2 3 4 5 6 7 8 // testDll.java public class testDll { static { System.loadLibrary(&amp;#34;testDll&amp;#34;); // dll名不需"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='/hiwikhome/jni/post.png'></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><div id=article-toolbar style=position:sticky;top:5px;z-index:1000><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>返回</span></a></div><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#调用对象类方法>调用对象类方法</a><ol><li><a href=#string>String</a></li><li><a href=#arraylist>ArrayList</a></li><li><a href=#exception>Exception</a></li></ol></li><li><a href=#普通数组>普通数组</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/hiwikhome/jni/><img src=/hiwikhome/jni/post_hu04bce9ff3cf39193bb266e9386cd2629_1184785_800x0_resize_box_3.png srcset="/hiwikhome/jni/post_hu04bce9ff3cf39193bb266e9386cd2629_1184785_800x0_resize_box_3.png 800w, /hiwikhome/jni/post_hu04bce9ff3cf39193bb266e9386cd2629_1184785_1600x0_resize_box_3.png 1600w" width=800 height=400 loading=lazy alt="Featured image of post JNI 调用 DLL"></a></div><div class=article-details><header class=article-category><a href=/categories/jni/>JNI
</a><a href=/categories/dll/>DLL
</a><a href=/categories/hehe/>HeHe</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/hiwikhome/jni/>JNI 调用 DLL</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024-12-24</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 3 分钟</time></div></footer></div></header><section class=article-content><blockquote><p>本文使用环境： java sdk 1.8 + visual studio 2017</p></blockquote><h1 id=java生成头文件>java生成头文件</h1><p>需声明待调用的dll中的方法为native方法</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// testDll.java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>testDll</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>static</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>loadLibrary</span><span class=p>(</span><span class=s>&#34;testDll&#34;</span><span class=p>);</span><span class=w> </span><span class=c1>// dll名不需要加.dll的后缀</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kd>native</span><span class=w> </span><span class=n>List</span><span class=o>&lt;</span><span class=n>List</span><span class=o>&lt;</span><span class=kt>float</span><span class=o>[]&gt;&gt;</span><span class=w> </span><span class=nf>getValue</span><span class=p>(</span><span class=kt>float</span><span class=o>[]</span><span class=w> </span><span class=n>nodeData</span><span class=p>,</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=n>nodeSize</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>csvPath</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>columnName</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>控制台使用<code>javac</code>（生成.class文件）和<code>javah</code>（生成.h文件）命令以生成.h文件。</p><p>例如上述testDll.java在本级目录cmd命令为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>javac testDll.java 
</span></span><span class=line><span class=cl>javah testDll
</span></span></code></pre></td></tr></table></div></div><p><img src=/hiwikhome/jni/image.png width=1195 height=192 srcset="/hiwikhome/jni/image_hu276b7c2f7ceb217bb394b38475c84c5b_50978_480x0_resize_box_3.png 480w, /hiwikhome/jni/image_hu276b7c2f7ceb217bb394b38475c84c5b_50978_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=622 data-flex-basis=1493px></p><h1 id=c构建dll工程>C++构建dll工程</h1><p>Visual Studio新建DLL工程。注意，工程名必须与java约定的dll名一致。</p><p><img src=/hiwikhome/jni/image-1.png width=1197 height=822 srcset="/hiwikhome/jni/image-1_huad3c24cbc335e80c50c364f800dbcdda_292242_480x0_resize_box_3.png 480w, /hiwikhome/jni/image-1_huad3c24cbc335e80c50c364f800dbcdda_292242_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=145 data-flex-basis=349px></p><p>工程的附加包含目录需添加jni.h、jni_md.h所在的目录。</p><p><img src=/hiwikhome/jni/image-2.png width=1199 height=607 srcset="/hiwikhome/jni/image-2_hu6ba956323d086a7d7899504a4a95c849_147508_480x0_resize_box_3.png 480w, /hiwikhome/jni/image-2_hu6ba956323d086a7d7899504a4a95c849_147508_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=197 data-flex-basis=474px>
<img src=/hiwikhome/jni/image-3.png width=1199 height=410 srcset="/hiwikhome/jni/image-3_hu5aeb436eebd3eb50a213c24783273717_80053_480x0_resize_box_3.png 480w, /hiwikhome/jni/image-3_hu5aeb436eebd3eb50a213c24783273717_80053_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=292 data-flex-basis=701px></p><p>将java生成的头文件加入工程，为其实现.cpp文件即可。</p><p><img src=/hiwikhome/jni/image-5.png width=1178 height=550 srcset="/hiwikhome/jni/image-5_hu2dfa2859b029922892ce31e94ee7a1d5_116427_480x0_resize_box_3.png 480w, /hiwikhome/jni/image-5_hu2dfa2859b029922892ce31e94ee7a1d5_116427_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=214 data-flex-basis=514px></p><h1 id=jni类型对应>JNI类型对应</h1><p>Java 基本类型与 C++ 基本类型的对应关系是通过 JNI 提供的原生类型（如 <code>jint</code>, <code>jfloat</code> 等）来实现的。</p><div class=table-wrapper><table><thead><tr><th>Java类型</th><th>C++类型</th><th>JNI对应类型</th></tr></thead><tbody><tr><td>boolean</td><td>bool</td><td>jboolean</td></tr><tr><td>byte</td><td>char</td><td>jbyte</td></tr><tr><td>short</td><td>short</td><td>jshort</td></tr><tr><td>int</td><td>int</td><td>jint</td></tr><tr><td>long</td><td>long</td><td>jlong</td></tr><tr><td>float</td><td>float</td><td>jfloat</td></tr><tr><td>double</td><td>double</td><td>jdouble</td></tr><tr><td>char</td><td>char</td><td>jchar</td></tr></tbody></table></div><p>Java 中的对象类型与 C++ 中的类或结构体对应。</p><div class=table-wrapper><table><thead><tr><th>Java类型</th><th>JNI类型</th></tr></thead><tbody><tr><td>string</td><td>jstring</td></tr><tr><td>object</td><td>jobject</td></tr><tr><td>class</td><td>jclass</td></tr><tr><td>ArrayList</td><td>jobject</td></tr><tr><td>int[]</td><td>jintArray</td></tr><tr><td>float[]</td><td>jfloatArray</td></tr><tr><td>double[]</td><td>jdoubleArray</td></tr><tr><td>long[]</td><td>jlongArray</td></tr><tr><td>object[]</td><td>jobjectArray</td></tr></tbody></table></div><h1 id=jni常用函数>JNI常用函数</h1><h2 id=调用对象类方法>调用对象类方法</h2><p>JNI调用对象类的函数使用逻辑大致为：获取到类(FindClass)→获取方法id(GetMethodId)→调用方法(Call***Method, ***取决于类型)【均通过JNIEnv * env操作】</p><h3 id=string>String</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=c1>// 获取 String 类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jclass</span> <span class=n>stringClass</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>FindClass</span><span class=p>(</span><span class=s>&#34;java/lang/String&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>stringClass</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取 String 类的构造方法 String(String)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jmethodID</span> <span class=n>stringConstructor</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetMethodID</span><span class=p>(</span><span class=n>stringClass</span><span class=p>,</span> <span class=s>&#34;&lt;init&gt;&#34;</span><span class=p>,</span> <span class=s>&#34;(Ljava/lang/String;)V&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>stringConstructor</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取 String 类的实例方法 length()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jmethodID</span> <span class=n>lengthMethod</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetMethodID</span><span class=p>(</span><span class=n>stringClass</span><span class=p>,</span> <span class=s>&#34;length&#34;</span><span class=p>,</span> <span class=s>&#34;()I&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>lengthMethod</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 调用构造方法创建一个 String 对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jstring</span> <span class=n>inputString</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=s>&#34;Hello, JNI!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>jobject</span> <span class=n>myString</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>NewObject</span><span class=p>(</span><span class=n>stringClass</span><span class=p>,</span> <span class=n>stringConstructor</span><span class=p>,</span> <span class=n>inputString</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 调用 length() 方法获取字符串长度
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jint</span> <span class=n>length</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>CallIntMethod</span><span class=p>(</span><span class=n>myString</span><span class=p>,</span> <span class=n>lengthMethod</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=arraylist>ArrayList</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=c1>// 获取 ArrayList 类
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jclass</span> <span class=n>arrayListClass</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>FindClass</span><span class=p>(</span><span class=s>&#34;java/util/ArrayList&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>arrayListClass</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取 ArrayList(int) 构造方法，用于指定初始容量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jmethodID</span> <span class=n>arrayListConstructor</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetMethodID</span><span class=p>(</span><span class=n>arrayListClass</span><span class=p>,</span> <span class=s>&#34;&lt;init&gt;&#34;</span><span class=p>,</span> <span class=s>&#34;(I)V&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>arrayListConstructor</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 设定初始容量
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=n>initialCapacity</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建一个指定初始容量的 ArrayList
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jobject</span> <span class=n>arrayListObj</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>NewObject</span><span class=p>(</span><span class=n>arrayListClass</span><span class=p>,</span> <span class=n>arrayListConstructor</span><span class=p>,</span> <span class=n>initialCapacity</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>arrayListObj</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 向 ArrayList 中添加元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jmethodID</span> <span class=n>addMethod</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetMethodID</span><span class=p>(</span><span class=n>arrayListClass</span><span class=p>,</span> <span class=s>&#34;add&#34;</span><span class=p>,</span> <span class=s>&#34;(Ljava/lang/Object;)Z&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>addMethod</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建字符串元素并添加到 ArrayList
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jstring</span> <span class=n>element1</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=s>&#34;Element 1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>-&gt;</span><span class=n>CallBooleanMethod</span><span class=p>(</span><span class=n>arrayListObj</span><span class=p>,</span> <span class=n>addMethod</span><span class=p>,</span> <span class=n>element1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>-&gt;</span><span class=n>DeleteLocalRef</span><span class=p>(</span><span class=n>element1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>jstring</span> <span class=n>element2</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>NewStringUTF</span><span class=p>(</span><span class=s>&#34;Element 2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>-&gt;</span><span class=n>CallBooleanMethod</span><span class=p>(</span><span class=n>arrayListObj</span><span class=p>,</span> <span class=n>addMethod</span><span class=p>,</span> <span class=n>element2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>-&gt;</span><span class=n>DeleteLocalRef</span><span class=p>(</span><span class=n>element2</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=exception>Exception</h3><p>抛出异常</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>jclass</span> <span class=n>exceptionClass</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>FindClass</span><span class=p>(</span><span class=s>&#34;java/lang/RuntimeException&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>exceptionClass</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>  <span class=c1>// 如果找不到异常类，直接返回
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 创建异常消息
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>msg</span> <span class=o>=</span> <span class=s>&#34;An error occurred in JNI&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 使用 ThrowNew 抛出异常
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>env</span><span class=o>-&gt;</span><span class=n>ThrowNew</span><span class=p>(</span><span class=n>exceptionClass</span><span class=p>,</span> <span class=n>msg</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>捕获和处理 Java 层抛出的异常</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=c1>// 假设我们有一些 JNI 操作，可能会抛出异常
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jmethodID</span> <span class=n>methodID</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetMethodID</span><span class=p>(</span><span class=n>someClass</span><span class=p>,</span> <span class=s>&#34;someMethod&#34;</span><span class=p>,</span> <span class=s>&#34;()V&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>methodID</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>  <span class=c1>// 打印异常信息
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionClear</span><span class=p>();</span>     <span class=c1>// 清理异常状态
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>-&gt;</span><span class=n>CallVoidMethod</span><span class=p>(</span><span class=n>someObject</span><span class=p>,</span> <span class=n>methodID</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 检查是否发生了异常
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionOccurred</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionDescribe</span><span class=p>();</span>  <span class=c1>// 打印异常信息
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>env</span><span class=o>-&gt;</span><span class=n>ExceptionClear</span><span class=p>();</span>     <span class=c1>// 清理异常状态
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>  <span class=c1>// 处理异常，返回 NULL
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=普通数组>普通数组</h2><p>对于数组，通常不需要使用 <code>GetFieldID</code> 或 <code>GetMethodID</code>，因为数组操作通常通过 JNI 提供的专门函数来进行，例如 <code>GetFloatArrayElements</code>、<code>SetFloatArrayRegion</code> 等。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=c1>// 创建一个 float 数组
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jfloatArray</span> <span class=n>floatArray</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>NewFloatArray</span><span class=p>(</span><span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>jfloat</span> <span class=n>values</span><span class=p>[</span><span class=mi>5</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mf>1.1f</span><span class=p>,</span> <span class=mf>2.2f</span><span class=p>,</span> <span class=mf>3.3f</span><span class=p>,</span> <span class=mf>4.4f</span><span class=p>,</span> <span class=mf>5.5f</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将数据写入数组
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>env</span><span class=o>-&gt;</span><span class=n>SetFloatArrayRegion</span><span class=p>(</span><span class=n>floatArray</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=n>values</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 获取数组中的元素
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>jfloat</span><span class=o>*</span> <span class=n>arrayElements</span> <span class=o>=</span> <span class=n>env</span><span class=o>-&gt;</span><span class=n>GetFloatArrayElements</span><span class=p>(</span><span class=n>floatArray</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>printf</span><span class=p>(</span><span class=s>&#34;Element at index %d: %f</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>i</span><span class=p>,</span> <span class=n>arrayElements</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>env</span><span class=o>-&gt;</span><span class=n>ReleaseFloatArrayElements</span><span class=p>(</span><span class=n>floatArray</span><span class=p>,</span> <span class=n>arrayElements</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/tags/jni/>JNI</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-ND</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><script src=//unpkg.com/@waline/client@v2/dist/waline.js></script><link href=//unpkg.com/@waline/client@v2/dist/waline.css rel=stylesheet><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script>Waline.init({dark:'html[data-scheme="dark"]',el:"#waline",emoji:["https://unpkg.com/@waline/emojis@1.0.1/weibo"],lang:"zh-cn",locale:{admin:"博主",placeholder:null},requiredMeta:["name","email","url"],serverURL:"https://hiwik-waline.vercel.app/"})</script><footer class=site-footer><section class=copyright>&copy;
2024 Hong Sikun</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.22.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script src=https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/nprogress.min.js integrity=sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/css/nprogress.css integrity=sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE crossorigin=anonymous><script>NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script></body></html>